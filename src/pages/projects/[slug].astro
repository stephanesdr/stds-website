---
import Layout from "@layouts/Layout.astro";
import type Project from "@interfaces/project";
import  {schema as projectSchema} from "@interfaces/project";
import SectionsComponent from "@components/details/SectionsComponent";
import ProjectDescription from "@components/details/ProjectDescription";

const { slug } = Astro.params;

let project: Project;

try {
	const query = {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify({
			query: `query GetProjectBySlugQuery($slug: String!) {
				project(where: {slug: $slug}) {
					${projectSchema()}
				}
			}`,
            variables: { slug }
		}),
	};

	const response = await fetch(import.meta.env.ASTRO_APP_HYGRAPH_ENDPOINT, query);
	const json = await response.json();

	project = json.data.project;

	if (!project) throw new Error("404 - Not Found");

} catch (error) {
	return Astro.redirect("/404");
}
---

<Layout title="My main page">
    <div class="project-list boxed w-full flex flex-row justify-start gap-4">
        <!-- left-col -->
        <div class="md:flex-1"></div>

        <!-- center-col -->
        <div class="md:flex-[3] relative">
            <div class="max-w-sm flex flex-col mx-auto items-center">
                {project.image && <img
                    class="card w-full h-full object-cover rounded-none items-center with-transition "
                    data-transition-name="project-card"
                    src={project.image.url}
                    alt="A description of my image."
                />}
            </div>

            <a href="/projects" class="fixed top-1 left-1 z-[999] inline-flex h-12 w-auto p-4 bg-slate-200 items-center text-black">&larr; Back</a>

            <div class="flex flex-col py-20">
                <div class="font-sans text-lg max-w-lg text-balance with-transition" data-transition-name="project-description">
                    {project.name},
                    <br>
                    <p class="text-balance">
                        {project.excerpt}
                    </p>
    
                </div>
                <!-- <div class="p-8 font-serif font-normal text-lg text-balance">{project.excerpt}</div> -->
                
            </div>
        </div>

        <!-- right col -->

        <div class="flex-1"></div>
    </div>

    {project && (
            <SectionsComponent
                project={project}
                client:only="react"
            />
        )
    }

    <ProjectDescription project={project} client:only="react">

</Layout>